# Поиск оптимального гиперкуба

  Задача - есть полный неориентированный граф, состоящий из n (2^rank) вершин. Требуется найти "гиперкуб" с минимальной суммой весов рёбер - подграф, который можно получить пронумеровав произвольным образом вершины от 0 до n и оставить только те рёбра, которые соединяют вершины с номерами, отличающиеся ровно в одной позиции в двоичном разложении (например для для rank = 3 это будут 000-001, 000-010, 000-100, 101-100 и т. д.).

  Оптимальный непереборный алгоритм найти не получилось, так что были использованы "решатели" - сторонние программы, 
предназначенные для решения задач удовлетворения ограничений (https://en.wikipedia.org/wiki/Constraint_satisfaction_problem).<br>
  На реальных данных решатели показывают впечатляющие результаты, даже если для задачи не известно полиномиального решения. Возможно, и эта задача не будет исключением.

### Подготовка
  Были использованы 2 независимых решателя - Chuffed, в составе MiniZinc distribution (https://www.minizinc.org/software.html),
и CPLEX (https://www.ibm.com/ru-ru/products/ilog-cplex-optimization-studio) - требуется к установке.

### Сборка
  Для создания jar-архива необходимо запустить Makefile (для Ubuntu).
  
### Запуск
`java -jar Hupercube.jar search <input> <tempDir> <timeLimitS> [oplSolver]` , <br>
где

+ \<input\> - файл с исходными данными в формате - в первой строке - n и rank, в последующих - матрица смежности графа.
+ \<tempDir\> - директория, где будут распологаться временные файлы, а также ответ в файле result.txt .
+ \<timeLimitS\> - максимальное время, которое готов ожидать пользователь на ожном исполнении решателя.
+ [oplSolver] - путь до oplrun - решателя для языка OPL (https://www.ibm.com/support/knowledgecenter/SSSA5P_12.7.0/ilog.odms.studio.help/pdf/opl_languser.pdf) из CPLEX-са. (У меня находился в CPLEX_Studio_Community129_full/opl/bin/x86-64_linux/) Если не задан, то используется Chuffed.

### Процесс поиска ответа
  Изначально выбирается интервал между максимально- и минимально- потенциально возможными возможными весами гиперкуба - суммы rank максимальных и rank минимальных рёбер вершины, поделённые пополам.
  
  Затем, бинарным поиском находим минимальное значение суммы, которое может найти решатель за отведённое время.
  
  Далее, аналогично находится граница, ниже которой решения точно не существует (решатель выдал unsutisfible).
  
  Как только найден ответ лучше текущего, он немедленно записывается в \<tempDir\>/result.txt, так что нет необходимости ждать полного завершения.

### Отличия решателей
  На большинстве случайных тестов решатель из CPLEX-а показал себя значительно лучше Chuffed-а. Так же у Chuffed-а слишком быстро растёт потребление памяти - при rank = 7 он потрябял больше 5-и Gib - чего не замечено у CPLEX-а. <br>
  В любом случае, стоит попробовать оба решателя - на реальных данных их поведение может измениться.

### Платформы, отличные от Ubuntu
  Так как напрямую в Java нельзя убить всех потомков процесса, пришлось использовать команды "pidof fzn-chuffed" - для нахождения id процесса и "kill" для его убийства. Для использования Chuffed требуется подобрать аналогичные команды.
  
  Также, в Windows путь к minizinc.exe и mzn2fzn.exe следует добавить в переменную "PATH".
